<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/screens/Home.jsx | banco</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-LoadingProvider">LoadingProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-useLoading">useLoading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Main">Main</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components">components</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ArrowBack">ArrowBack</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ChangeData">ChangeData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-LogoImage">LogoImage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MoneysGraph">MoneysGraph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-TooltipComp">TooltipComp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-homecomponents">components/homeComponents</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Balance">Balance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Header">Header</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-HomeModal">HomeModal</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-HorizontalMenuOption">HorizontalMenuOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Menu">Menu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MovementRegister">MovementRegister</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Movements">Movements</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#database">database</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/firebaseMethods.js~Storage.html">Storage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#screens">screens</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AuthScreen">AuthScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Graphs">Graphs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Home">Home</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Money">Money</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Perfil">Perfil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Settings">Settings</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#screens-subscreens">screens/subscreens</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-InvestmentsCheckbox">InvestmentsCheckbox</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SaveInvestments">SaveInvestments</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SplashScreen">SplashScreen</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server">server</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/apidata.js~ApiRequests.html">ApiRequests</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/screens/Home.jsx</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, { useState, useEffect } from &apos;react&apos;;
import { ScrollView, StatusBar } from &apos;react-native&apos;;
import AsyncStorage from &apos;@react-native-async-storage/async-storage&apos;;
import { useLoading } from &apos;../Context&apos;;
import Storage from &apos;./../database/firebaseMethods&apos;;
import Balance from &apos;../components/homeComponents/Balance&apos;;
import Header from &apos;../components/homeComponents/Header&apos;;
import Menu from &apos;../components/homeComponents/Menu&apos;;
import Movements from &apos;../components/homeComponents/Movements&apos;;


const statusBarHeight = StatusBar.currentHeight ? StatusBar.currentHeight + 5 : 64

export default function Home({ navigation }) {
  const { showLoading, hideLoading, getShouldRefresh, setShouldRefresh } = useLoading();
  const [moneyGraph, SetMoneyGraph] = useState([{}]);

  const [isRefresh, setIsRefresh] = useState(false);

  const refresh = async () =&gt; {
    const doc = await AsyncStorage.getItem(&apos;userDoc&apos;);
    const fr = new Storage(doc);
    let res = await fr.getFullDoc();
    await AsyncStorage.setItem(&apos;fullUserData&apos;, JSON.stringify(res))
  };

  const [userData, setUserData] = useState({});

  const [money, setMoney] = useState([]);
  const [income, setIncome] = useState(0);
  const [negative, setNegative] = useState(0);

  const [msg, setMsg] = useState(&apos;&apos;);


  const parseDate = (dateString) =&gt; {
    if (dateString) {
      const [day, month, year] = dateString.split(&apos;/&apos;);
      return new Date(`${year}-${month}-${day}`);
    } else {
      return new Date();
    }
  };


  const [showBalanceTip, setBalanceTip] = useState(false);
  const [showMenuTip, setShowMenuTip] = useState(false);
  const [showMovementsTip, setShowMovementsTip] = useState(false);
  const [showSettingsTip, setShowSettingsTip] = useState(false);

  useEffect(() =&gt; {
    let res;
    const getAllData = async () =&gt; {
      let isNew = await AsyncStorage.getItem(&apos;isNew&apos;);

      if (isNew === &apos;true&apos;) {
        setBalanceTip(true);
        await AsyncStorage.removeItem(&apos;isNew&apos;);
      };

      try {
        showLoading();
        if (getShouldRefresh()) {
          const doc = await AsyncStorage.getItem(&apos;userDoc&apos;);
          const fr = new Storage(doc);
          const dadosDoBanco = await fr.getFullDoc(doc);
          await AsyncStorage.setItem(&apos;fullUserData&apos;, JSON.stringify(dadosDoBanco));
          setShouldRefresh(false);
        }

        const fullRes = await AsyncStorage.getItem(&apos;fullUserData&apos;);
        res = JSON.parse(fullRes);

        if (res) {
          setUserData(res.userData);

          let allIncomes = [];
          let incomeSum = 0;
          if (res.incomes) {
            res.incomes.forEach(element =&gt; {
              allIncomes.push({
                ...element,
                type: 1
              })
              incomeSum += parseFloat(element.value);
            });
          }
          setIncome(incomeSum.toFixed(2));

          let allExpenses = [];
          let expenseSum = 0;
          if (res.expenses) {
            res.expenses.forEach(element =&gt; {
              allExpenses.push({
                ...element,
                type: 0
              })
              expenseSum += parseFloat(element.value);
            });
          }
          setNegative(expenseSum.toFixed(2));

          let allMoney = [...allIncomes, ...allExpenses];

          SetMoneyGraph({
            incomes: allIncomes,
            expenses: allExpenses,
            moneyFlow: [
              {
                name: &quot;incomes&quot;,
                value: incomeSum.toFixed(2)
              },
              {
                name: &quot;expenses&quot;,
                value: expenseSum.toFixed(2)
              }
            ],
          })

          const listaOrdenada = allMoney.sort((a, b) =&gt; {
            const dataA = parseDate(a.date);
            const dataB = parseDate(b.date);
            return dataB - dataA;
          });

          setMoney(listaOrdenada);
          setMsg(&quot;&quot;)
        } else {
          setMsg(&apos;Nenhum dado encontrado!&apos;);
        }

      } catch (err) {
        console.log(err);
        setMsg(&apos;Nenhum dado encontrado!&apos;);
      } finally {
        setShouldRefresh(false);
        hideLoading();
      }

    };


    getAllData().catch(console.error);

  }, [isRefresh]);


  return (
    &lt;ScrollView style={{ marginTop: statusBarHeight, flex: 1 }}&gt;

      &lt;Header userData={userData} navigation={navigation} /&gt;

      &lt;Balance showBalanceTip={showBalanceTip} setBalanceTip={setBalanceTip}
        setShowMenuTip={setShowMenuTip} income={income} negative={negative} /&gt;

      &lt;Menu refresh={refresh} isRefresh={setIsRefresh} navigation={navigation} moneyGraph={moneyGraph}
        showMenuTip={showMenuTip} setTip={() =&gt; { setShowMovementsTip(true); setShowMenuTip(false); }}
        showSettingsTip={showSettingsTip} setShowSettingsTip={setShowSettingsTip} /&gt;

      &lt;Movements money={money} showMovementsTip={showMovementsTip} msg={msg}
        setShowMovementsTip={() =&gt; { setShowMovementsTip(false); setShowSettingsTip(true); }} /&gt;

    &lt;/ScrollView&gt;
  );
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
